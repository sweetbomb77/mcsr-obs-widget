<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SIMGHST Dashboard v0.2.1</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0a0a0f; --card: rgba(20, 20, 30, 0.95); --accent: #7d5fff; --win: #00ff88; --loss: #ff4757; }
        body { margin: 0; padding: 10px; font-family: 'Outfit', sans-serif; color: white; background: transparent; width: 350px; }
        
        .container { 
            background: var(--card); border: 1px solid rgba(255,255,255,0.1); border-radius: 24px; padding: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5); position: relative; overflow: hidden;
        }

        /* Header Layout */
        .header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        .user-info { display: flex; flex-direction: column; }
        .username { font-weight: 900; font-size: 18px; letter-spacing: 1px; color: #fff; }
        .rank-badge { 
            background: rgba(125, 95, 255, 0.15); color: var(--accent); padding: 4px 10px; 
            border-radius: 8px; font-size: 11px; font-weight: 800; border: 1px solid var(--accent);
            margin-top: 4px; display: inline-flex; align-items: center; gap: 5px;
        }

        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-box { background: rgba(255,255,255,0.03); padding: 12px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.05); }
        .label { font-size: 10px; color: #888; text-transform: uppercase; font-weight: 600; margin-bottom: 2px; }
        .value { font-size: 22px; font-weight: 800; }

        /* Progress Bar */
        .progress-container { margin-bottom: 15px; }
        .progress-label { display: flex; justify-content: space-between; font-size: 10px; color: #aaa; margin-bottom: 6px; font-weight: 600; }
        .bar-bg { background: rgba(255,255,255,0.1); height: 8px; border-radius: 10px; overflow: hidden; }
        .bar-fill { height: 100%; background: linear-gradient(90deg, var(--accent), #a389ff); width: 0%; transition: width 1s ease; }

        /* Footer Info */
        .footer { display: flex; justify-content: space-between; align-items: center; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.05); }
        .record-pill { font-size: 12px; font-weight: 700; color: #ccc; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--win); box-shadow: 0 0 8px var(--win); }
        
        .v-tag { position: absolute; top: 0; right: 20px; font-size: 40px; font-weight: 900; color: rgba(255,255,255,0.02); pointer-events: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="v-tag">0.2.1</div>
    
    <div class="header">
        <div class="user-info">
            <span class="username">SIMGHST</span>
            <div class="rank-badge">
                <span id="rank-icon">â¬›</span>
                <span id="rank-text">COAL III</span>
            </div>
        </div>
        <div style="text-align: right;">
            <div class="label">Peak Elo</div>
            <div id="peak-elo" style="font-size: 14px; font-weight: 800; color: #aaa;">---</div>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-box">
            <div class="label">Current Elo</div>
            <div id="elo" class="value">---</div>
        </div>
        <div class="stat-box">
            <div class="label">Win Rate</div>
            <div id="wr" class="value">--%</div>
        </div>
    </div>

    <div class="progress-container">
        <div class="progress-label">
            <span>Progress to Iron I</span>
            <span id="next-rank-val">0/600</span>
        </div>
        <div class="bar-bg">
            <div id="bar-fill" class="bar-fill"></div>
        </div>
    </div>

    <div class="footer">
        <div id="record-pill" class="record-pill">34W - 33L</div>
        <div style="display: flex; align-items: center; gap: 8px;">
            <span style="font-size: 10px; font-weight: 700; color: #666;">LIVE SYNC</span>
            <div class="status-dot"></div>
        </div>
    </div>
</div>

<script>
    const BRIDGE = 'https://script.google.com/macros/s/AKfycbygvsvLV51L7addBEBvIsWTSqg5tVz6vuxaynPcEsb153jYBHThOIgoczuDahk8dn1t/exec';
    const KEY = 'lyidaeudwfggjkfydsdglvqaby839pyxmp8e2zovl4fg5mfhbu0zxz4qijhmzyn9';
    const USER = 'simghst';

    function getRankData(elo) {
        const ranks = [
            {min: 2000, name: "Netherite", icon: "ðŸŸ£"},
            {min: 1500, name: "Diamond", icon: "ðŸ’Ž"},
            {min: 1200, name: "Emerald", icon: "â‡ï¸"},
            {min: 900, name: "Gold", icon: "ðŸŸ¡"},
            {min: 600, name: "Iron", icon: "âšª"},
            {min: 400, name: "Coal III", icon: "â¬›"},
            {min: 200, name: "Coal II", icon: "â¬›"},
            {min: 0, name: "Coal I", icon: "â¬›"}
        ];
        return ranks.find(r => elo >= r.min) || ranks[7];
    }

    async function update() {
        try {
            const url = `https://api.mcsrranked.com/users/${USER}?api_key=${KEY}`;
            const res = await fetch(`${BRIDGE}?url=${encodeURIComponent(url)}`);
            const json = await res.json();
            
            if (json.status === "success") {
                const u = json.data;
                const s = u.statistics?.season || {};
                
                const elo = u.eloRate || 0;
                const peak = u.seasonPeakElo || elo;
                const rank = getRankData(elo);

                // Basic Stats
                document.getElementById('elo').innerText = elo;
                document.getElementById('peak-elo').innerText = peak;
                document.getElementById('rank-text').innerText = rank.name;
                document.getElementById('rank-icon').innerText = rank.icon;

                // Winrate (No Forfeits)
                const wins = s.wins?.ranked || 0;
                const loses = s.loses?.ranked || 0;
                const total = wins + loses;
                const wr = total > 0 ? ((wins / total) * 100).toFixed(1) : "0.0";
                
                document.getElementById('wr').innerText = wr + "%";
                document.getElementById('record-pill').innerText = `${wins}W - ${loses}L`;

                // Progress Bar (Target: Iron I @ 600 Elo)
                const progress = Math.min((elo / 600) * 100, 100);
                document.getElementById('bar-fill').style.width = progress + "%";
                document.getElementById('next-rank-val').innerText = `${elo}/600`;
            }
        } catch (e) {
            console.error("Sync Error");
        }
    }

    update();
    setInterval(update, 60000);
</script>
</body>
</html>
