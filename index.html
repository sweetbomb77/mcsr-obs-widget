<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SIMGHST Dashboard v0.2.4</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0a0a0f; --card: rgba(20, 20, 30, 0.95); --accent: #7d5fff; --win: #00ff88; --loss: #ff4757; --draw: #ffcc00; }
        body { margin: 0; padding: 10px; font-family: 'Outfit', sans-serif; color: white; background: transparent; width: 350px; }
        .container { background: var(--card); border: 1px solid rgba(255,255,255,0.1); border-radius: 24px; padding: 18px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); position: relative; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .username { font-weight: 900; font-size: 18px; color: #fff; display: flex; align-items: center; gap: 8px; }
        .pb-tag { font-size: 10px; color: #888; font-weight: 600; background: rgba(255,255,255,0.05); padding: 2px 6px; border-radius: 4px; }
        .rank-badge { background: rgba(125, 95, 255, 0.15); color: var(--accent); padding: 4px 10px; border-radius: 8px; font-size: 11px; font-weight: 800; border: 1px solid var(--accent); display: flex; align-items: center; gap: 5px; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat-box { background: rgba(255,255,255,0.03); padding: 10px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.05); }
        .label { font-size: 9px; color: #888; text-transform: uppercase; font-weight: 700; }
        .value { font-size: 20px; font-weight: 800; }
        .match-result { background: rgba(255,255,255,0.02); border-radius: 14px; padding: 12px; margin-bottom: 15px; border-left: 4px solid #444; position: relative; }
        .res-header { font-size: 10px; font-weight: 800; text-transform: uppercase; margin-bottom: 8px; color: #aaa; }
        .player-row { display: flex; justify-content: space-between; align-items: center; margin: 4px 0; }
        .p-name { font-size: 13px; font-weight: 700; display: flex; align-items: center; gap: 6px; }
        .p-time { font-size: 13px; font-weight: 900; color: var(--accent); }
        .progress-bar { background: rgba(255,255,255,0.1); height: 6px; border-radius: 10px; overflow: hidden; margin: 8px 0; }
        .bar-fill { height: 100%; background: var(--accent); width: 0%; transition: width 1s ease; }
        .footer { display: flex; justify-content: space-between; align-items: center; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.05); font-size: 11px; font-weight: 700; color: #444; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div>
            <div class="username">SIMGHST <span class="pb-tag" id="my-pb">PB: --:--</span></div>
            <div class="rank-badge"><span id="rank-icon">â¬›</span> <span id="rank-text">COAL III</span></div>
        </div>
        <div style="text-align: right;"><div class="label">Peak</div><div id="peak-elo" style="font-size: 14px; font-weight: 800; color: #aaa;">---</div></div>
    </div>

    <div class="stats-grid">
        <div class="stat-box"><div class="label">Elo</div><div id="elo" class="value">---</div></div>
        <div class="stat-box"><div class="label">Win Rate</div><div id="wr" class="value">--%</div></div>
    </div>

    <div id="match-card" class="match-result">
        <div class="res-header" id="res-type">Last Match</div>
        <div class="player-row">
            <span class="p-name">You</span>
            <span class="p-time" id="my-res-time"></span>
        </div>
        <div class="player-row">
            <span class="p-name" id="opp-display">Opponent <span class="pb-tag" id="opp-pb">PB: N/A</span></span>
            <span class="p-time" id="opp-res-time" style="color:#888;"></span>
        </div>
    </div>

    <div style="display:flex; justify-content:space-between; font-size:9px; color:#555; font-weight:800; text-transform:uppercase;">
        <span>To Iron I</span><span id="prog-val">0/600</span>
    </div>
    <div class="progress-bar"><div id="bar-fill" class="bar-fill"></div></div>

    <div class="footer"><span id="record-pill">34W - 33L</span><span>V 0.2.4</span></div>
</div>

<script>
    const BRIDGE = 'https://script.google.com/macros/s/AKfycbygvsvLV51L7addBEBvIsWTSqg5tVz6vuxaynPcEsb153jYBHThOIgoczuDahk8dn1t/exec';
    const KEY = 'lyidaeudwfggjkfydsdglvqaby839pyxmp8e2zovl4fg5mfhbu0zxz4qijhmzyn9';
    const USER = 'simghst';

    function formatTime(ms) {
        if (!ms || ms === 0) return "N/A";
        const totalSec = Math.floor(ms / 1000);
        return `${Math.floor(totalSec / 60)}:${(totalSec % 60).toString().padStart(2, '0')}`;
    }

    async function update() {
        try {
            const pUrl = `https://api.mcsrranked.com/users/${USER}?api_key=${KEY}`;
            const mUrl = `https://api.mcsrranked.com/users/${USER}/matches?count=1&api_key=${KEY}`;
            
            const [pRes, mRes] = await Promise.all([
                fetch(`${BRIDGE}?url=${encodeURIComponent(pUrl)}`).then(r => r.json()),
                fetch(`${BRIDGE}?url=${encodeURIComponent(mUrl)}`).then(r => r.json())
            ]);

            if (pRes.status === "success") {
                const u = pRes.data;
                const s = u.statistics?.season || {};
                document.getElementById('elo').innerText = u.eloRate;
                document.getElementById('peak-elo').innerText = u.seasonPeakElo || u.eloRate;
                document.getElementById('my-pb').innerText = `PB: ${formatTime(s.bestTime?.ranked)}`;
                
                const w = s.wins?.ranked || 0;
                const l = s.loses?.ranked || 0;
                const total = w + l;
                document.getElementById('wr').innerText = total > 0 ? ((w/total)*100).toFixed(1) + "%" : "0.0%";
                document.getElementById('record-pill').innerText = `${w}W - ${l}L`;
                
                document.getElementById('bar-fill').style.width = Math.min((u.eloRate/600)*100, 100) + "%";
                document.getElementById('prog-val').innerText = `${u.eloRate}/600`;
                
                const ranks = [[2000,"Netherite","ðŸŸ£"],[1500,"Diamond","ðŸ’Ž"],[1200,"Emerald","â‡ï¸"],[900,"Gold","ðŸŸ¡"],[600,"Iron","âšª"],[400,"Coal III","â¬›"],[200,"Coal II","â¬›"],[0,"Coal I","â¬›"]];
                const r = ranks.find(rk => u.eloRate >= rk[0]) || [0,"Coal I","â¬›"];
                document.getElementById('rank-text').innerText = r[1];
                document.getElementById('rank-icon').innerText = r[2];
            }

            if (mRes.status === "success" && mRes.data.length > 0) {
                const m = mRes.data[0];
                const card = document.getElementById('match-card');
                const me = m.players.find(p => p.nickname.toLowerCase() === USER.toLowerCase());
                const opp = m.players.find(p => p.nickname.toLowerCase() !== USER.toLowerCase());
                
                // Set Opponent display
                document.getElementById('opp-display').innerHTML = `${opp.nickname} <span class="pb-tag">PB: ${formatTime(opp.statistics?.season?.bestTime?.ranked)}</span>`;
                
                const winnerUUID = m.result.uuid;
                const timeStr = formatTime(m.result.time);

                document.getElementById('my-res-time').innerText = "";
                document.getElementById('opp-res-time').innerText = "";

                if (!winnerUUID) {
                    document.getElementById('res-type').innerText = "Last Match: Draw";
                    card.style.borderLeftColor = "var(--draw)";
                } else if (winnerUUID === me.uuid) {
                    document.getElementById('res-type').innerText = "Last Match: Win";
                    document.getElementById('my-res-time').innerText = timeStr;
                    card.style.borderLeftColor = "var(--win)";
                } else {
                    document.getElementById('res-type').innerText = "Last Match: Loss";
                    document.getElementById('opp-res-time').innerText = timeStr;
                    card.style.borderLeftColor = "var(--loss)";
                }
            }
        } catch (e) { console.error(e); }
    }

    update();
    setInterval(update, 60000);
</script>
</body>
</html>
