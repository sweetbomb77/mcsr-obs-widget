<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SIMGHST Dashboard v0.2.7</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0a0a0f; --card: rgba(20, 20, 30, 0.95); --accent: #7d5fff; --win: #00ff88; --loss: #ff4757; --draw: #ffcc00; }
        body { margin: 0; padding: 10px; font-family: 'Outfit', sans-serif; color: white; background: transparent; width: 360px; }
        .container { background: var(--card); border: 1px solid rgba(255,255,255,0.1); border-radius: 24px; padding: 18px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); position: relative; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .rank-badge { background: rgba(125, 95, 255, 0.15); color: var(--accent); padding: 4px 10px; border-radius: 8px; font-size: 11px; font-weight: 800; border: 1px solid var(--accent); display: flex; align-items: center; gap: 5px; }
        
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat-box { background: rgba(255,255,255,0.03); padding: 10px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.05); }
        .label { font-size: 9px; color: #888; text-transform: uppercase; font-weight: 700; }
        .value { font-size: 20px; font-weight: 800; }

        .match-result { background: rgba(255,255,255,0.02); border-radius: 18px; padding: 15px; margin-bottom: 15px; border-bottom: 3px solid #444; }
        .res-status { text-align: center; font-size: 11px; font-weight: 900; letter-spacing: 2px; margin-bottom: 12px; }
        
        .vs-container { display: flex; justify-content: space-between; align-items: flex-start; }
        .vs-player { display: flex; flex-direction: column; width: 38%; }
        .vs-player.right { text-align: right; }
        
        .p-name { font-size: 15px; font-weight: 800; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .p-pb { font-size: 9px; color: #666; font-weight: 700; margin-top: 2px; }
        
        .vs-center { display: flex; flex-direction: column; align-items: center; width: 24%; margin-top: -2px; }
        .vs-divider { font-style: italic; font-weight: 900; color: rgba(255,255,255,0.1); font-size: 16px; }
        .finish-time { font-size: 19px; font-weight: 900; margin-top: 4px; filter: drop-shadow(0 0 5px rgba(0,0,0,0.5)); }

        .progress-bar { background: rgba(255,255,255,0.1); height: 6px; border-radius: 10px; overflow: hidden; margin: 8px 0; }
        .bar-fill { height: 100%; background: var(--accent); width: 0%; transition: width 1s ease; }
        .footer { display: flex; justify-content: space-between; align-items: center; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.05); font-size: 11px; font-weight: 700; color: #444; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div class="rank-badge"><span id="rank-icon">â¬›</span> <span id="rank-text">COAL III</span></div>
        <div style="text-align: right;"><div class="label">Peak</div><div id="peak-elo" style="font-size: 14px; font-weight: 800; color: #aaa;">---</div></div>
    </div>

    <div class="stats-grid">
        <div class="stat-box"><div class="label">Elo</div><div id="elo" class="value">---</div></div>
        <div class="stat-box"><div class="label">Win Rate</div><div id="wr" class="value">--%</div></div>
    </div>

    <div id="match-card" class="match-result">
        <div class="res-status" id="res-type">LAST MATCH</div>
        <div class="vs-container">
            <div class="vs-player">
                <span class="p-name" style="color: var(--accent);">Simghst</span>
                <span class="p-pb" id="my-match-pb">PB: --:--</span>
            </div>

            <div class="vs-center">
                <div class="vs-divider">VS</div>
                <div class="finish-time" id="match-finish-time"></div>
            </div>

            <div class="vs-player right">
                <span class="p-name" id="opp-name">Opponent</span>
                <span class="p-pb" id="opp-pb">PB: N/A</span>
            </div>
        </div>
    </div>

    <div style="display:flex; justify-content:space-between; font-size:9px; color:#555; font-weight:800; text-transform:uppercase;">
        <span>To Iron I</span><span id="prog-val">0/600</span>
    </div>
    <div class="progress-bar"><div id="bar-fill" class="bar-fill"></div></div>

    <div class="footer"><span id="record-pill">34W - 33L</span><span>V 0.2.7</span></div>
</div>

<script>
    const BRIDGE = 'https://script.google.com/macros/s/AKfycbygvsvLV51L7addBEBvIsWTSqg5tVz6vuxaynPcEsb153jYBHThOIgoczuDahk8dn1t/exec';
    const KEY = 'lyidaeudwfggjkfydsdglvqaby839pyxmp8e2zovl4fg5mfhbu0zxz4qijhmzyn9';
    const USER = 'simghst';

    function formatTime(ms) {
        if (!ms || ms === 0) return "N/A";
        const totalSec = Math.floor(ms / 1000);
        return `${Math.floor(totalSec / 60)}:${(totalSec % 60).toString().padStart(2, '0')}`;
    }

    async function update() {
        try {
            const pUrl = `https://api.mcsrranked.com/users/${USER}?api_key=${KEY}`;
            const mUrl = `https://api.mcsrranked.com/users/${USER}/matches?count=1&api_key=${KEY}`;
            
            const [pRes, mRes] = await Promise.all([
                fetch(`${BRIDGE}?url=${encodeURIComponent(pUrl)}`).then(r => r.json()),
                fetch(`${BRIDGE}?url=${encodeURIComponent(mUrl)}`).then(r => r.json())
            ]);

            if (pRes.status === "success") {
                const u = pRes.data;
                const s = u.statistics?.season || {};
                document.getElementById('elo').innerText = u.eloRate;
                document.getElementById('peak-elo').innerText = u.seasonPeakElo || u.eloRate;
                document.getElementById('my-match-pb').innerText = `PB: ${formatTime(s.bestTime?.ranked)}`;
                
                const w = s.wins?.ranked || 0;
                const l = s.loses?.ranked || 0;
                document.getElementById('wr').innerText = (w+l) > 0 ? ((w/(w+l))*100).toFixed(1) + "%" : "0.0%";
                document.getElementById('record-pill').innerText = `${w}W - ${l}L`;
                
                document.getElementById('bar-fill').style.width = Math.min((u.eloRate/600)*100, 100) + "%";
                document.getElementById('prog-val').innerText = `${u.eloRate}/600`;
            }

            if (mRes.status === "success" && mRes.data.length > 0) {
                const m = mRes.data[0];
                const card = document.getElementById('match-card');
                const me = m.players.find(p => p.nickname.toLowerCase() === USER.toLowerCase());
                const opp = m.players.find(p => p.nickname.toLowerCase() !== USER.toLowerCase());
                
                document.getElementById('opp-name').innerText = opp.nickname;
                document.getElementById('opp-pb').innerText = `PB: ${formatTime(opp.statistics?.season?.bestTime?.ranked)}`;
                
                const winnerUUID = m.result.uuid;
                const timeEl = document.getElementById('match-finish-time');
                const timeStr = formatTime(m.result.time);

                if (!winnerUUID) {
                    document.getElementById('res-type').innerText = "DRAW";
                    document.getElementById('res-type').style.color = "var(--draw)";
                    timeEl.innerText = "";
                    card.style.borderBottomColor = "var(--draw)";
                } else if (winnerUUID === me.uuid) {
                    document.getElementById('res-type').innerText = "WIN";
                    document.getElementById('res-type').style.color = "var(--win)";
                    timeEl.innerText = timeStr;
                    timeEl.style.color = "var(--win)";
                    card.style.borderBottomColor = "var(--win)";
                } else {
                    document.getElementById('res-type').innerText = "LOSS";
                    document.getElementById('res-type').style.color = "var(--loss)";
                    timeEl.innerText = timeStr;
                    timeEl.style.color = "var(--loss)";
                    card.style.borderBottomColor = "var(--loss)";
                }
            }
        } catch (e) { console.error(e); }
    }

    update();
    setInterval(update, 60000);
</script>
</body>
</html>
